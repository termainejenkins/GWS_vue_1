
import debug from 'debug'
import playwright from 'playwright'
import { chromium } from 'playwright'; 

const browser = await chromium.launch();
const page = await browser.newPage();



// locators
  const jobList = page.locator('.jobs-list-item .information a')
  const nextButton = page.getByRole('button', {name: 'View next page'})
  //const nextButton = page.locator('.pagination_click')       //('div.pagination-block au-target')      //('#next')

async function extractPageResults() {
  const jobsOnPage = await jobList.count();

  const response: { title: string; url: string; jobListing: string }[] = [];

  for (let i = 0; i < jobsOnPage; i++) {
    const listing = jobList.nth(i);

    const jobListing = listing.innerText();

    const url = await listing.evaluate((link) => link.href);

    const title = await listing.evaluate((link) => link.innerText);

    response.push({
      title,
      url,
      jobListing,
    });
  }

  return response;
}



if (debug) {
  await page.pause();
}


await page.goto("https://jobs.centene.com/us/en/search-results?keywords=RN", {
  waitUntil: "networkidle",
});

  while (true) {
    await extractPageResults()
    if (debug) {
      await page.pause()
    }
    if (!!await nextButton.count()) {
      const nextUrl = await nextButton.evaluate((link) => link.href) as string
      await Promise.all([
        page.waitForURL(nextUrl, {waitUntil: 'networkidle'}),
        nextButton.click(),
      ])
    } else {
      break
    }
    return response
  }
  

